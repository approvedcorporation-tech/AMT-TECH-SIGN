<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signage | Config Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #0a0a0a; color: #f5f5f5; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); transition: all 0.2s ease; }
        .glass-card:hover { border-color: rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.08); }
        input[type="range"] { accent-color: #3b82f6; }
        input[type="text"], input[type="number"], textarea, select {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px 12px; color: white;
        }
        input:focus { border-color: #3b82f6; outline: none; }
        .tab-active { background: #3b82f6; color: white; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        .preview-pane { position: sticky; top: 2rem; }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen">

    <!-- Header Actions -->
    <header class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
        <div>
            <h1 class="text-2xl font-bold tracking-tight">Lumina Config Editor</h1>
            <p class="text-white/40 text-sm font-medium uppercase tracking-[0.1em]">Designed & coded by Hardy • v1.3.0</p>
        </div>
        <div class="flex flex-wrap gap-2">
            <input type="file" id="fileInput" class="hidden" accept=".json">
            <button onclick="document.getElementById('fileInput').click()" class="glass-card px-4 py-2 rounded-xl text-sm flex items-center gap-2">
                <i data-lucide="upload" class="w-4 h-4"></i> Load JSON
            </button>
            <button onclick="copyJson()" class="glass-card px-4 py-2 rounded-xl text-sm flex items-center gap-2">
                <i data-lucide="copy" class="w-4 h-4"></i> Copy
            </button>
            <button onclick="downloadJson()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-xl text-sm font-semibold flex items-center gap-2 transition-colors">
                <i data-lucide="download" class="w-4 h-4"></i> Download config.json
            </button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <!-- Sidebar Navigation -->
        <nav class="lg:col-span-3 space-y-2">
            <button onclick="showTab('theme')" id="btn-theme" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl glass-card text-left transition-all">
                <i data-lucide="palette" class="w-5 h-5"></i> Theme Settings
            </button>
            <button onclick="showTab('announcements')" id="btn-announcements" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl glass-card text-left transition-all">
                <i data-lucide="megaphone" class="w-5 h-5"></i> Announcements
            </button>
            <button onclick="showTab('events')" id="btn-events" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl glass-card text-left transition-all">
                <i data-lucide="calendar" class="w-5 h-5"></i> Upcoming Events
            </button>
            <button onclick="showTab('ticker')" id="btn-ticker" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl glass-card text-left transition-all">
                <i data-lucide="scroll-text" class="w-5 h-5"></i> Ticker Bar
            </button>
            <button onclick="showTab('news')" id="btn-news" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl glass-card text-left transition-all">
                <i data-lucide="newspaper" class="w-5 h-5"></i> Campus News
            </button>

            <div class="pt-6">
                <div id="validationPanel" class="p-4 rounded-xl border border-green-500/20 bg-green-500/10 text-xs text-green-400">
                    <div class="flex items-center gap-2">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        Config Valid
                    </div>
                </div>
                <div class="mt-4 flex items-center gap-2 px-2 opacity-30">
                    <div class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-[9px] font-black uppercase tracking-widest">System Engine Running</span>
                </div>
            </div>
        </nav>

        <!-- Editor Area -->
        <section class="lg:col-span-5 glass p-6 rounded-3xl space-y-8 custom-scroll max-h-[80vh] overflow-y-auto">
            
            <!-- Theme Tab -->
            <div id="tab-theme" class="tab-content space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold">Theme Settings</h2>
                    <button onclick="resetTheme()" class="text-xs text-blue-400 hover:text-blue-300">Reset to Defaults</button>
                </div>
                <div class="space-y-4">
                    <label class="block text-sm">UI Scale <span id="val-uiScale" class="float-right text-blue-400">1.0</span>
                        <input type="range" id="uiScale" min="0.85" max="1.20" step="0.01" class="w-full mt-2" oninput="updateField('theme.uiScale', this.value)">
                    </label>
                    <label class="block text-sm">Base Font Size (px) <span id="val-baseFont" class="float-right text-blue-400">16</span>
                        <input type="range" id="baseFont" min="12" max="24" step="1" class="w-full mt-2" oninput="updateField('theme.baseFont', this.value)">
                    </label>
                    <label class="block text-sm">Overlay Opacity <span id="val-overlayOpacity" class="float-right text-blue-400">0.3</span>
                        <input type="range" id="overlayOpacity" min="0.10" max="0.80" step="0.01" class="w-full mt-2" oninput="updateField('theme.overlayOpacity', this.value)">
                    </label>
                    <label class="block text-sm">Spacing Scale <span id="val-spacingScale" class="float-right text-blue-400">1.0</span>
                        <input type="range" id="spacingScale" min="0.85" max="1.20" step="0.01" class="w-full mt-2" oninput="updateField('theme.spacingScale', this.value)">
                    </label>
                </div>
            </div>

            <!-- Announcements Tab -->
            <div id="tab-announcements" class="tab-content hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold">Announcements</h2>
                    <button onclick="addItem('announcements')" class="bg-blue-600 px-3 py-1 rounded-lg text-xs font-bold">+ Add New</button>
                </div>
                <div id="announcements-list" class="space-y-4"></div>
            </div>

            <!-- Events Tab -->
            <div id="tab-events" class="tab-content hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold">Upcoming Events</h2>
                    <button onclick="addItem('events')" class="bg-blue-600 px-3 py-1 rounded-lg text-xs font-bold">+ Add New</button>
                </div>
                <div class="grid grid-cols-2 gap-4 pb-4 border-b border-white/10">
                    <label class="block text-xs uppercase text-white/40 tracking-widest font-bold">Auto Scroll
                        <select onchange="updateField('events.autoScroll', this.value === 'true')" id="eventAutoScroll" class="w-full mt-1">
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </label>
                    <label class="block text-xs uppercase text-white/40 tracking-widest font-bold">Speed
                        <input type="number" id="eventScrollSpeed" class="w-full mt-1" oninput="updateField('events.scrollSpeed', this.value)">
                    </label>
                </div>
                <div id="events-list" class="space-y-4"></div>
            </div>

            <!-- Ticker Tab -->
            <div id="tab-ticker" class="tab-content hidden space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-semibold">Ticker Manager</h2>
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-white/40">Enabled</span>
                        <input type="checkbox" id="tickerEnabled" onchange="updateField('ticker.enabled', this.checked)">
                    </div>
                </div>
                <label class="block text-sm">Scroll Speed (px/s) <span id="val-tickerSpeed" class="float-right text-blue-400">30</span>
                    <input type="range" id="tickerSpeed" min="10" max="100" step="5" class="w-full mt-2" oninput="updateField('ticker.speed', this.value)">
                </label>
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <h3 class="text-sm font-bold text-white/40 uppercase tracking-widest">Ticker Strings</h3>
                        <button onclick="addTickerItem()" class="text-blue-400 text-xs">+ Add</button>
                    </div>
                    <div id="ticker-list" class="space-y-2"></div>
                </div>
            </div>

            <!-- News Tab -->
            <div id="tab-news" class="tab-content hidden space-y-6">
                <h2 class="text-xl font-semibold">Campus News Settings</h2>
                <div class="space-y-4">
                    <label class="block text-sm font-medium">Data Source
                        <select id="newsSource" class="w-full mt-2" onchange="updateField('campusNews.source', this.value)">
                            <option value="gdelt">GDELT Global Monitor</option>
                            <option value="guardian">The Guardian API</option>
                        </select>
                    </label>
                    <label class="block text-sm font-medium">Search Query
                        <input type="text" id="newsQuery" class="w-full mt-2" placeholder="e.g. University News" oninput="updateField('campusNews.query', this.value)">
                    </label>
                    <label class="block text-sm font-medium">Refresh Interval (min) <span id="val-newsRefresh" class="float-right text-blue-400">30</span>
                        <input type="range" id="newsRefresh" min="5" max="120" step="5" class="w-full mt-2" oninput="updateField('campusNews.refreshMinutes', this.value)">
                    </label>
                </div>
            </div>

        </section>

        <!-- Preview Area -->
        <aside class="lg:col-span-4 space-y-6">
            <div class="preview-pane glass p-6 rounded-3xl space-y-6">
                <h2 class="text-sm font-bold uppercase tracking-[0.2em] text-white/40 mb-4">Live Layout Preview</h2>
                
                <!-- Announcement Preview -->
                <div id="preview-announcement" class="rounded-2xl overflow-hidden bg-cover bg-center h-40 flex flex-col justify-end p-4 border border-white/10" style="background-image: url('https://images.unsplash.com/photo-1543269865-cbf427effbad?q=80&w=500&auto=format&fit=crop');">
                    <div class="glass p-3 rounded-xl">
                        <span id="prev-ann-priority" class="text-[10px] uppercase font-black bg-blue-600 px-2 py-0.5 rounded mb-1 inline-block">Normal</span>
                        <h3 id="prev-ann-title" class="font-bold text-sm truncate">Annual Science Fair</h3>
                        <p id="prev-ann-body" class="text-xs text-white/60 line-clamp-1">Register your teams at the lobby desk before Friday.</p>
                    </div>
                </div>

                <!-- Event Preview -->
                <div class="glass p-4 rounded-2xl space-y-3">
                    <h3 class="text-xs font-bold text-white/40 uppercase">Upcoming Events</h3>
                    <div class="space-y-2" id="preview-events-list">
                        <div class="flex items-center gap-3">
                            <div class="bg-blue-600/20 text-blue-400 p-2 rounded-lg"><i data-lucide="clock" class="w-4 h-4"></i></div>
                            <div>
                                <p class="text-xs font-bold">Jazz Concert</p>
                                <p class="text-[10px] text-white/40">Today • 4:00 PM</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticker Preview -->
                <div class="bg-black/40 border border-white/5 rounded-full px-4 py-2 overflow-hidden">
                    <div class="whitespace-nowrap text-xs font-medium animate-pulse" id="preview-ticker">
                        Signage Ticker Loading...
                    </div>
                </div>

                <div class="bg-yellow-500/10 border border-yellow-500/20 p-4 rounded-2xl">
                    <p class="text-[10px] font-bold text-yellow-500 uppercase flex items-center gap-2">
                        <i data-lucide="info" class="w-3 h-3"></i> Sync Notice
                    </p>
                    <p class="text-[11px] text-white/60 mt-1 leading-relaxed">Changes are saved to browser local storage automatically. Use 'Download' to finalize.</p>
                </div>
            </div>
        </aside>
    </main>

    <script>
        // Initial Default Config
        let config = {
            version: "1.3.0",
            updatedAt: new Date().toISOString(),
            theme: {
                uiScale: 1.0,
                baseFont: 16,
                overlayOpacity: 0.30,
                spacingScale: 1.0
            },
            announcements: [
                {
                    title: "Annual Science Fair",
                    body: "Register your teams at the lobby desk before Friday evening.",
                    imageUrl: "https://images.unsplash.com/photo-1543269865-cbf427effbad?q=80&w=500&auto=format&fit=crop",
                    enabled: true,
                    priority: "normal"
                }
            ],
            events: {
                autoScroll: true,
                scrollSpeed: 10,
                items: [
                    { title: "Jazz Concert", date: "2023-11-20", time: "16:00", location: "Auditorium" },
                    { title: "Final Exams Start", date: "2023-12-01", time: "08:00", location: "Gym" }
                ]
            },
            ticker: {
                enabled: true,
                speed: 30,
                items: [
                    "Early dismissal this Thursday at 1:00 PM.",
                    "Go Tigers! Basketball finals tonight @ 7.",
                    "Cafeteria: Taco Tuesday!"
                ]
            },
            campusNews: {
                source: "gdelt",
                query: "Higher Education News",
                refreshMinutes: 30
            }
        };

        // --- Logic Engine ---

        function init() {
            const saved = localStorage.getItem('lumina_config');
            if (saved) {
                try {
                    config = JSON.parse(saved);
                } catch(e) { console.error("Corrupt local storage", e); }
            }
            lucide.createIcons();
            refreshUI();
            showTab('theme');
        }

        function refreshUI() {
            // Theme
            document.getElementById('uiScale').value = config.theme.uiScale;
            document.getElementById('baseFont').value = config.theme.baseFont;
            document.getElementById('overlayOpacity').value = config.theme.overlayOpacity;
            document.getElementById('spacingScale').value = config.theme.spacingScale;
            updateLabels();

            // News
            document.getElementById('newsSource').value = config.campusNews.source;
            document.getElementById('newsQuery').value = config.campusNews.query;
            document.getElementById('newsRefresh').value = config.campusNews.refreshMinutes;

            // Ticker
            document.getElementById('tickerEnabled').checked = config.ticker.enabled;
            document.getElementById('tickerSpeed').value = config.ticker.speed;

            // Events Global
            document.getElementById('eventAutoScroll').value = config.events.autoScroll ? "true" : "false";
            document.getElementById('eventScrollSpeed').value = config.events.scrollSpeed;

            renderAnnouncements();
            renderEvents();
            renderTickerItems();
            updatePreview();
            saveLocal();
        }

        function updateLabels() {
            document.getElementById('val-uiScale').innerText = config.theme.uiScale;
            document.getElementById('val-baseFont').innerText = config.theme.baseFont + 'px';
            document.getElementById('val-overlayOpacity').innerText = config.theme.overlayOpacity;
            document.getElementById('val-spacingScale').innerText = config.theme.spacingScale;
            document.getElementById('val-tickerSpeed').innerText = config.ticker.speed + 'px/s';
            document.getElementById('val-newsRefresh').innerText = config.campusNews.refreshMinutes + 'm';
        }

        function updateField(path, value) {
            const keys = path.split('.');
            let obj = config;
            for (let i = 0; i < keys.length - 1; i++) {
                obj = obj[keys[i]];
            }
            
            // Type conversion
            const val = isNaN(value) || value === "" ? value : parseFloat(value);
            obj[keys[keys.length - 1]] = val;
            
            config.updatedAt = new Date().toISOString();
            updateLabels();
            updatePreview();
            saveLocal();
        }

        function saveLocal() {
            localStorage.setItem('lumina_config', JSON.stringify(config));
            validateConfig();
        }

        function validateConfig() {
            const panel = document.getElementById('validationPanel');
            let errors = [];
            if (!config.announcements || !Array.isArray(config.announcements)) errors.push("Announcements missing");
            if (!config.theme) errors.push("Theme missing");

            if (errors.length > 0) {
                panel.className = "p-4 rounded-xl border border-red-500/20 bg-red-500/10 text-xs text-red-400";
                panel.innerHTML = `<div><i data-lucide="alert-triangle" class="w-4 h-4 inline mr-2"></i> ${errors[0]}</div>`;
            } else {
                panel.className = "p-4 rounded-xl border border-green-500/20 bg-green-500/10 text-xs text-green-400";
                panel.innerHTML = `<div><i data-lucide="check-circle" class="w-4 h-4 inline mr-2"></i> Config Valid</div>`;
            }
            lucide.createIcons();
        }

        // --- Tab Management ---

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tabId).classList.remove('hidden');

            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('tab-active'));
            document.getElementById('btn-' + tabId).classList.add('tab-active');
        }

        // --- Item Management ---

        function renderAnnouncements() {
            const list = document.getElementById('announcements-list');
            list.innerHTML = "";
            config.announcements.forEach((ann, idx) => {
                const card = document.createElement('div');
                card.className = "glass-card p-4 rounded-2xl space-y-3 relative";
                card.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-[10px] font-bold text-white/40 uppercase">Card #${idx+1}</span>
                        <div class="flex gap-2">
                            <button onclick="moveItem('announcements', ${idx}, -1)" class="p-1 hover:text-blue-400"><i data-lucide="chevron-up" class="w-4 h-4"></i></button>
                            <button onclick="moveItem('announcements', ${idx}, 1)" class="p-1 hover:text-blue-400"><i data-lucide="chevron-down" class="w-4 h-4"></i></button>
                            <button onclick="deleteItem('announcements', ${idx})" class="p-1 text-red-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                    <input type="text" class="w-full text-sm font-bold" value="${ann.title}" placeholder="Title" oninput="updateItem('announcements', ${idx}, 'title', this.value)">
                    <textarea class="w-full text-xs" rows="2" placeholder="Body Text" oninput="updateItem('announcements', ${idx}, 'body', this.value)">${ann.body}</textarea>
                    <div class="grid grid-cols-2 gap-2">
                        <select class="text-xs" onchange="updateItem('announcements', ${idx}, 'priority', this.value)">
                            <option value="normal" ${ann.priority === 'normal' ? 'selected' : ''}>Normal</option>
                            <option value="important" ${ann.priority === 'important' ? 'selected' : ''}>Important</option>
                        </select>
                        <input type="text" class="text-xs" value="${ann.imageUrl || ''}" placeholder="Image URL" oninput="updateItem('announcements', ${idx}, 'imageUrl', this.value)">
                    </div>
                `;
                list.appendChild(card);
            });
            lucide.createIcons();
        }

        function renderEvents() {
            const list = document.getElementById('events-list');
            list.innerHTML = "";
            config.events.items.forEach((ev, idx) => {
                const card = document.createElement('div');
                card.className = "glass-card p-4 rounded-2xl space-y-2 relative";
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <div class="flex gap-2">
                            <button onclick="moveItem('events.items', ${idx}, -1)" class="hover:text-blue-400"><i data-lucide="chevron-up" class="w-3 h-3"></i></button>
                            <button onclick="moveItem('events.items', ${idx}, 1)" class="hover:text-blue-400"><i data-lucide="chevron-down" class="w-3 h-3"></i></button>
                        </div>
                        <button onclick="deleteItem('events.items', ${idx})" class="text-red-400"><i data-lucide="x" class="w-4 h-4"></i></button>
                    </div>
                    <input type="text" class="w-full text-xs font-bold" value="${ev.title}" placeholder="Event Name" oninput="updateItem('events.items', ${idx}, 'title', this.value)">
                    <div class="grid grid-cols-3 gap-2">
                        <input type="text" class="text-[10px]" value="${ev.date}" placeholder="Date" oninput="updateItem('events.items', ${idx}, 'date', this.value)">
                        <input type="text" class="text-[10px]" value="${ev.time}" placeholder="Time" oninput="updateItem('events.items', ${idx}, 'time', this.value)">
                        <input type="text" class="text-[10px]" value="${ev.location}" placeholder="Loc" oninput="updateItem('events.items', ${idx}, 'location', this.value)">
                    </div>
                `;
                list.appendChild(card);
            });
            lucide.createIcons();
        }

        function renderTickerItems() {
            const list = document.getElementById('ticker-list');
            list.innerHTML = "";
            config.ticker.items.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = "flex gap-2";
                div.innerHTML = `
                    <input type="text" class="flex-1 text-xs" value="${item}" oninput="updateItem('ticker.items', ${idx}, null, this.value)">
                    <button onclick="deleteItem('ticker.items', ${idx})" class="p-2 glass-card rounded-lg text-red-400"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                `;
                list.appendChild(div);
            });
            lucide.createIcons();
        }

        function updateItem(path, idx, key, value) {
            const parts = path.split('.');
            let arr = config;
            parts.forEach(p => arr = arr[p]);
            
            if (key) arr[idx][key] = value;
            else arr[idx] = value;
            
            updatePreview();
            saveLocal();
        }

        function addItem(path) {
            if (path === 'announcements') {
                config.announcements.push({ title: "New Announcement", body: "Description...", imageUrl: "", enabled: true, priority: "normal" });
            } else if (path === 'events') {
                config.events.items.push({ title: "New Event", date: "2024-01-01", time: "09:00", location: "Campus" });
            }
            refreshUI();
        }

        function addTickerItem() {
            config.ticker.items.push("New ticker message...");
            refreshUI();
        }

        function deleteItem(path, idx) {
            const parts = path.split('.');
            let arr = config;
            parts.forEach(p => arr = arr[p]);
            arr.splice(idx, 1);
            refreshUI();
        }

        function moveItem(path, idx, delta) {
            const parts = path.split('.');
            let arr = config;
            parts.forEach(p => arr = arr[p]);
            
            const newIdx = idx + delta;
            if (newIdx < 0 || newIdx >= arr.length) return;
            
            const item = arr.splice(idx, 1)[0];
            arr.splice(newIdx, 0, item);
            refreshUI();
        }

        function resetTheme() {
            config.theme = { uiScale: 1.0, baseFont: 16, overlayOpacity: 0.30, spacingScale: 1.0 };
            refreshUI();
        }

        // --- Previews ---

        function updatePreview() {
            if (config.announcements.length > 0) {
                const ann = config.announcements[0];
                document.getElementById('prev-ann-title').innerText = ann.title;
                document.getElementById('prev-ann-body').innerText = ann.body;
                document.getElementById('prev-ann-priority').innerText = ann.priority;
                document.getElementById('prev-ann-priority').className = `text-[10px] uppercase font-black px-2 py-0.5 rounded mb-1 inline-block ${ann.priority === 'important' ? 'bg-red-600' : 'bg-blue-600'}`;
                document.getElementById('preview-announcement').style.backgroundImage = `url('${ann.imageUrl || 'https://images.unsplash.com/photo-1543269865-cbf427effbad?q=80&w=500&auto=format&fit=crop'}')`;
            }

            const evPreview = document.getElementById('preview-events-list');
            evPreview.innerHTML = "";
            config.events.items.slice(0, 2).forEach(ev => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-3";
                div.innerHTML = `
                    <div class="bg-blue-600/20 text-blue-400 p-2 rounded-lg"><i data-lucide="clock" class="w-4 h-4"></i></div>
                    <div><p class="text-xs font-bold">${ev.title}</p><p class="text-[10px] text-white/40">${ev.time} @ ${ev.location}</p></div>
                `;
                evPreview.appendChild(div);
            });

            document.getElementById('preview-ticker').innerText = config.ticker.items.join(" • ");
            lucide.createIcons();
        }

        // --- File IO ---

        function downloadJson() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config, null, 4));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "config.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function copyJson() {
            navigator.clipboard.writeText(JSON.stringify(config, null, 4)).then(() => {
                alert("JSON copied to clipboard!");
            });
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const imported = JSON.parse(event.target.result);
                    config = { ...config, ...imported };
                    refreshUI();
                } catch(e) { alert("Invalid JSON file"); }
            };
            reader.readAsText(e.target.files[0]);
        });

        // Bootstrap
        window.onload = init;
    </script>
</body>
</html>